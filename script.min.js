const statusDisplay=document.querySelector(".game-status"),currentPlayerDisplay=document.querySelector(".current-player"),cells=document.querySelectorAll(".cell"),modal=$(".modal"),winningMessage=()=>"Čestitamo, pobedili ste",loserMessage=()=>"Izgubili ste, više sreće drugi put",drawMessage=()=>"Nema pobednika",afterRestartMessage=()=>"";cells.forEach(e=>e.addEventListener("click",click)),document.querySelector(".game-restart").addEventListener("click",restartGame);const player="X",computer="O";let gameActive=!0,moveNumber=0,currentPlayer="",gameState=["","","","","","","","","","","","","","","",""];const winningConditions=[[0,1,2,3],[4,5,6,7],[8,9,10,11],[12,13,14,15],[0,4,8,12],[1,5,9,13],[2,6,10,14],[3,7,11,15],[0,5,10,15],[3,6,9,12],[0,1,4,5],[1,2,5,6],[2,3,6,7],[4,5,8,9],[5,6,9,10],[6,7,10,11],[8,9,12,13],[9,10,13,14],[10,11,14,15]];let random,firstPlayerCell;function setFirstPlayer(){clearInterval(random),currentPlayer=Math.random()>.5?player:computer,currentPlayerDisplay.innerHTML=currentPlayer,currentPlayer===computer&&computerClick()}function computerClick(){setTimeout(function(){currentPlayer===computer&&cells[0].click()},500)}function setRandomInterval(){random=setInterval(()=>{currentPlayerDisplay.textContent===player?currentPlayerDisplay.innerHTML=computer:currentPlayerDisplay.innerHTML=player},100)}function handleCellPlayed(e,t){gameState[t]=currentPlayer,e.innerHTML=currentPlayer}function changePlayer(){currentPlayer="X"===currentPlayer?"O":"X",moveNumber++,currentPlayerDisplay.innerHTML=currentPlayer,currentPlayer===computer&&computerClick()}function handleResultValidation(){let e=!1,t=!1;for(let r=0;r<=18;r++){const a=winningConditions[r];let n=gameState[a[0]],l=gameState[a[1]],i=gameState[a[2]],o=gameState[a[3]];if(""!==n&&""!==l&&""!==i&&""!==o&&(n===l&&l===i&&i===o)){o===player?e=!0:o===computer&&(t=!0),document.querySelector(`div[data-cell-index="${a[0]}"]`).style.background="#722620",document.querySelector(`div[data-cell-index="${a[1]}"]`).style.background="#722620",document.querySelector(`div[data-cell-index="${a[2]}"]`).style.background="#722620",document.querySelector(`div[data-cell-index="${a[3]}"]`).style.background="#722620";break}}return e?(statusDisplay.innerHTML=winningMessage(),modal.modal({backdrop:"static",keyboard:!1}),void(gameActive=!1)):t?(statusDisplay.innerHTML=loserMessage(),modal.modal({backdrop:"static",keyboard:!1}),void(gameActive=!1)):gameState.includes("")?void changePlayer():(statusDisplay.innerHTML=drawMessage(),modal.modal(),void(gameActive=!1))}function click(e){let t,r;if(currentPlayer===player)t=e.target,r=parseInt(t.getAttribute("data-cell-index")),0===moveNumber&&(firstPlayerCell=r);else{if(currentPlayer!==computer)return;r=findBestMove([...gameState]),t=document.querySelector(`div[data-cell-index="${r}"]`)}""===gameState[r]&&gameActive&&(handleCellPlayed(t,r),handleResultValidation())}function restartGame(){gameActive=!0,moveNumber=0,gameState=["","","","","","","","","","","","","","","",""],cells.forEach(e=>e.innerHTML=""),cells.forEach(e=>e.style.background="#30110D"),statusDisplay.innerHTML=afterRestartMessage(),setRandomInterval(),setTimeout(setFirstPlayer,3e3)}function isMovesLeft(e){for(let t=0;t<16;t++)if(""===e[t])return!0;return!1}function evaluate(e){for(let t=0;t<=18;t++){const r=winningConditions[t];let a=e[r[0]],n=e[r[1]],l=e[r[2]],i=e[r[3]];if(a===n&&n===l&&l===i){if(i===computer)return 10;if(i===player)return-10}}return 0}function minimax(e,t,r,a,n){if(score=evaluate(e),10===score)return score-t;if(-10===score)return score+t;if(!isMovesLeft(e)||5===t||moveNumber<3)return 0;if(r){let l=-1/0;for(let i=0;i<16;i++)if(""===e[i]){e[i]=computer,moveNumber++;let o=minimax([...e],t+1,!r,a,n);if(l=Math.max(l,o),a=Math.max(a,l),moveNumber--,e[i]="",n<=a)break}return l}{let l=1/0;for(let i=0;i<16;i++)if(""===e[i]){e[i]=player,moveNumber++;let o=minimax([...e],t+1,!r,a,n);if(l=Math.min(l,o),n=Math.min(n,l),moveNumber--,e[i]="",n<=a)break}return l}}function findBestMove(e){if(10===firstPlayerCell&&1===moveNumber)return 9;let t=-1/0,r=-1;for(let a=5;a<16;a++)if(""===e[a]){e[a]=computer,moveNumber++;let n=minimax([...e],0,!1);e[a]="",moveNumber--,n>t&&(r=a,t=n)}for(let a=0;a<5;a++)if(""===e[a]){e[a]=computer,moveNumber++;let n=minimax([...e],0,!1);e[a]="",moveNumber--,n>t&&(r=a,t=n)}return r}setRandomInterval(),setTimeout(setFirstPlayer,3e3);